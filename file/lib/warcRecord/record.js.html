<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">lib/warcRecord/record.js | node-warc</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A high fidelity, user scriptable, archival crawler that uses Chrome with/without a head."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="node-warc"><meta property="twitter:description" content="A high fidelity, user scriptable, archival crawler that uses Chrome with/without a head."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/N0taN3rd/node-warc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parsers">parsers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parsers/autoWARCParser.js~AutoWARCParser.html">AutoWARCParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parsers/gzipDetector.js~GzipDetector.html">GzipDetector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parsers/warcGzParser.js~WARCGzParser.html">WARCGzParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parsers/warcParser.js~WARCParser.html">WARCParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parsers/warcStreamTransform.js~WARCStreamTransform.html">WARCStreamTransform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-recordIterator">recordIterator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#requestcapturers">requestCapturers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/requestCapturers/capturedRequest.js~CapturedRequest.html">CapturedRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/requestCapturers/cdpRequestInfo.js~CDPRequestInfo.html">CDPRequestInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/requestCapturers/electron.js~ElectronRequestCapturer.html">ElectronRequestCapturer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/requestCapturers/puppeteer.js~PuppeteerRequestCapturer.html">PuppeteerRequestCapturer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/requestCapturers/puppeteerCDP.js~PuppeteerCDPRequestCapturer.html">PuppeteerCDPRequestCapturer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/requestCapturers/remoteChrome.js~RemoteChromeRequestCapturer.html">RemoteChromeRequestCapturer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/requestCapturers/requestHandler.js~RequestHandler.html">RequestHandler</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/utils/electronGetResError.js~ElectronGetResError.html">ElectronGetResError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getResBodyElectron">getResBodyElectron</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringifyHeaders">stringifyHeaders</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringifyRequestHeaders">stringifyRequestHeaders</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isEmptyPlainObject">isEmptyPlainObject</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#warcrecord">warcRecord</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/warcRecord/builder.js~RecordBuilder.html">RecordBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/warcRecord/record.js~WARCRecord.html">WARCRecord</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/warcRecord/warcContentParsers.js~ContentParser.html">ContentParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RequestHTTP">RequestHTTP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ResponseHTTP">ResponseHTTP</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#writers">writers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/writers/electron.js~ElectronWARCGenerator.html">ElectronWARCGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/writers/puppeteer.js~PuppeteerWARCGenerator.html">PuppeteerWARCGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/writers/puppeteerCDP.js~PuppeteerCDPWARCGenerator.html">PuppeteerCDPWARCGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/writers/remoteChrome.js~RemoteChromeWARCGenerator.html">RemoteChromeWARCGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/writers/warcWriterBase.js~WARCWriterBase.html">WARCWriterBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WARCInfoContent">WARCInfoContent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WARCInfoHeader">WARCInfoHeader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WARCMetadataHeader">WARCMetadataHeader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WARCRequestHeader">WARCRequestHeader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WARCResponseHeader">WARCResponseHeader</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/warcRecord/record.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;
const ContentParser = require(&apos;./warcContentParsers&apos;)

/**
 * @type {{warcinfo: string, metadata: string, request: string, response: string, revisit: string, resource: string, conversion: string, unknown: string, continuation: string}}
 */
const WARCTypes = {
  warcinfo: &apos;warcinfo&apos;,
  metadata: &apos;metadata&apos;,
  request: &apos;request&apos;,
  response: &apos;response&apos;,
  revisit: &apos;revisit&apos;,
  resource: &apos;resource&apos;,
  conversion: &apos;conversion&apos;,
  unknown: &apos;unknown&apos;,
  continuation: &apos;continuation&apos;
}

/**
 * @desc WARC record class. The WARC named fields are properties on this object
 */
class WARCRecord {
  /**
   * @desc Create a new WARCRecord
   * @param {{header: Buffer[], c1: Buffer[], c2: Buffer[]}} warcParts - The parts of a warc record
   */
  constructor (warcParts) {
    /**
     * @desc An object containing the parsed WARC header
     * @type {Object}
     */
    this.warcHeader = ContentParser.parseWarcRecordHeader(warcParts.header)

    /**
     * @desc An object containing the parsed request or response records HTTP information
     * @type {?RequestHTTP|?ResponseHTTP}
     */
    this.httpInfo = null

    /**
     * @desc The content of the record.
     * @type {Buffer}
     */
    this.content = null

    const wt = this.warcType
    switch (wt) {
      case WARCTypes.request:
      case WARCTypes.response:
        this.httpInfo = ContentParser.parseHTTPPortion(
          warcParts.c1,
          wt === WARCTypes.request
        )
        this.content = Buffer.concat(warcParts.c2 || [])
        break
      case WARCTypes.revisit:
        this.httpInfo = ContentParser.parseResHTTP(warcParts.c1)
        break
      default:
        this.content = Buffer.concat(warcParts.c1 || [])
        break
    }
  }

  /**
   * @desc Determine if this warc record header has the supplied WARC named field.
   * If the supplied header key does not start with WARC then this it will be added.
   * @example
   *  // both ways are equivalent to determine if the record has the WARC-Type field
   *  record.hasWARCHeader(&apos;WARC-Type&apos;)
   *  record.hasWARCHeader(&apos;Type&apos;)
   * @param {!string} headerKey - The WARC header key (named field)
   * @return {boolean}
   */
  hasWARCHeader (headerKey) {
    if (!headerKey.startsWith(&apos;WARC&apos;)) {
      headerKey = `WARC-${headerKey}`
    }
    return this.warcHeader[headerKey] != null
  }

  /**
   * @desc Retrieve the value of this records header field.
   * If the supplied header key does not start with WARC then this it will be added.
   * @example
   *  // both ways are equivalent to retrieve WARC-Type field
   *  record.getWARCHeader(&apos;WARC-Type&apos;)
   *  record.getWARCHeader(&apos;Type&apos;)
   * @param {!string} headerKey - The WARC header key (named field)
   * @return {?string}
   */
  getWARCHeader (headerKey) {
    if (!headerKey.startsWith(&apos;WARC&apos;)) {
      headerKey = `WARC-${headerKey}`
    }
    return this.warcHeader[headerKey]
  }

  /**
   * @return {?string}
   */
  get warcType () {
    return this.warcHeader[&apos;WARC-Type&apos;]
  }

  /**
   * @return {?string}
   */
  get warcRecordID () {
    return this.warcHeader[&apos;WARC-Record-ID&apos;]
  }

  /**
   * @return {?string}
   */
  get warcDate () {
    return this.warcHeader[&apos;WARC-Date&apos;]
  }

  /**
   * @return {?string}
   */
  get warcContentLength () {
    return this.warcHeader[&apos;Content-Length&apos;]
  }

  /**
   * @return {?string}
   */
  get warcContentType () {
    return this.warcHeader[&apos;Content-Type&apos;]
  }

  /**
   * @return {?string}
   */
  get warcConcurrentTo () {
    return this.warcHeader[&apos;WARC-Concurrent-To&apos;]
  }

  /**
   * @return {?string}
   */
  get warcBlockDigest () {
    return this.warcHeader[&apos;WARC-Block-Digest&apos;]
  }

  /**
   * @return {?string}
   */
  get warcPayloadDigest () {
    return this.warcHeader[&apos;WARC-Payload-Digest&apos;]
  }

  /**
   * @return {?string}
   */
  get warcIPAddress () {
    return this.warcHeader[&apos;WARC-IP-Address&apos;]
  }

  /**
   * @return {?string}
   */
  get warcRefersTo () {
    return this.warcHeader[&apos;WARC-Refers-To&apos;]
  }

  /**
   * @return {?string}
   */
  get warcRefersToTargetURI () {
    return this.warcHeader[&apos;WARC-Refers-To-Target-URI&apos;]
  }

  /**
   * @return {?string}
   */
  get warcRefersToDate () {
    return this.warcHeader[&apos;WARC-Refers-To-Date&apos;]
  }

  /**
   * @return {?string}
   */
  get warcTargetURI () {
    return this.warcHeader[&apos;WARC-Target-URI&apos;]
  }

  /**
   * @return {?string}
   */
  get warcTruncated () {
    return this.warcHeader[&apos;WARC-Truncated&apos;]
  }

  /**
   * @return {?string}
   */
  get warcWarcinfoID () {
    return this.warcHeader[&apos;WARC-Warcinfo-ID&apos;]
  }

  /**
   * @return {?string}
   */
  get warcFilename () {
    return this.warcHeader[&apos;WARC-Filename&apos;]
  }

  /**
   * @return {?string}
   */
  get warcProfile () {
    return this.warcHeader[&apos;WARC-Profile&apos;]
  }

  /**
   * @return {?string}
   */
  get warcIdentifiedPayloadType () {
    return this.warcHeader[&apos;WARC-Identified-Payload-Type&apos;]
  }

  /**
   * @return {?string}
   */
  get warcSegmentOriginID () {
    return this.warcHeader[&apos;WARC-Segment-Origin-ID&apos;]
  }

  /**
   * @return {?string}
   */
  get warcSegmentNumber () {
    return this.warcHeader[&apos;WARC-Segment-Number&apos;]
  }

  /**
   * @return {?string}
   */
  get warcSegmentTotalLength () {
    return this.warcHeader[&apos;WARC-Segment-Total-Length&apos;]
  }
}

/**
 * @type {WARCRecord}
 */
module.exports = WARCRecord
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
